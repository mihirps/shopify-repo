{%- if settings.notification_text != blank or settings.countdown_timer_enable or settings.notification_button_name != blank -%}
<div id="notification-bar-placeholder" style="display: none;"></div>

<script>
  // Defer notification bar creation and rendering
  window.addEventListener('load', function() {
    setTimeout(function() {
      const placeholder = document.getElementById('notification-bar-placeholder');
      if (placeholder) {
        const notificationBar = document.createElement('div');
        notificationBar.className = 'top-notification-bar';
        notificationBar.setAttribute('aria-hidden', 'true');
        
        // Create the structure first
        notificationBar.innerHTML = `
          <div class="container">
            <div class="row">
              <div class="col-12">
                <div class="notification-entry text-center">
                  <div class="notification-entry-inner">
                    <div class="notification-text" data-notification-text></div>
                    {%- if settings.countdown_timer_enable -%}
                    <div class="product-countdown grid-countdown topbar-countdown" data-countdown="{{ settings.countdown_date }}" loading="lazy"></div> 
                    {%- endif -%}
                    {%- if settings.notification_button_name != blank -%}
                    <div class="notification-button-wrapper">
                      <a class="notification-button" href="{{ settings.notification_button_url }}" loading="lazy">{{ settings.notification_button_name }}</a>
                    </div>
                    {%- endif -%}
                  </div>
                  <button class="notification-close-btn" aria-label="Close notification"><i class="pe-7s-close"></i></button>
                </div>
              </div>
            </div>
          </div>
        `;
        
        // Replace placeholder with the structure
        placeholder.parentNode.replaceChild(notificationBar, placeholder);
        
        // Add the text content after a delay
        setTimeout(function() {
          const textElement = notificationBar.querySelector('[data-notification-text]');
          if (textElement) {
            {%- if settings.notification_text != blank -%}
            {%- assign clean_text = settings.notification_text | strip_html | strip -%}
            textElement.textContent = {%- if clean_text contains '<p>' -%}
              {{ clean_text | replace: '<p>', '' | replace: '</p>', '' | json }}
            {%- else -%}
              {{ clean_text | json }}
            {%- endif -%};
            {%- endif -%}
            notificationBar.removeAttribute('aria-hidden');
          }
        }, 500);
      }
    }, 1000);
  });
</script>

<style>
  .top-notification-bar {
    position: relative;
    z-index: 100;
    will-change: transform;
    transform: translateZ(0);
    background: var(--notification-bg, #ffffff);
  }
  .notification-entry {
    padding: 10px 0;
  }
  .notification-text {
    display: inline-block;
    font-size: 14px;
    line-height: 1.4;
    margin: 0;
    padding: 0;
    color: var(--notification-text-color, #000000);
  }
  .notification-button-wrapper {
    display: inline-block;
    margin-left: 10px;
  }
  .notification-button {
    display: inline-block;
    text-decoration: none;
    color: var(--notification-button-color, #000000);
  }
  @media (max-width: 767px) {
    .notification-text {
      font-size: 12px;
    }
  }
</style>
{%- endif -%}