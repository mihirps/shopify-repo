{% liquid
  assign theme_rtl = false
  if settings.rtl_enable and settings.langauges_rtl == blank
    assign theme_rtl = true
  endif

  if settings.rtl_enable and settings.langauges_rtl != blank
    assign rtl_languages = settings.langauges_rtl | split: ','
    for language in rtl_languages
      if language == request.locale.iso_code
        assign theme_rtl = true
      endif
    endfor
  endif
%}
<!doctype html>
<!--[if IE 9]> <html class="ie9 no-js supports-no-cookies" lang="{{ shop.locale }}"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js supports-no-cookies" lang="{{ request.locale.iso_code }}" {% if theme_rtl %}dir="rtl"{% endif %}> <!--<![endif]-->
  
<head>
  <!-- Basic and Helper page needs -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="{{ settings.color_primary }}">
  <link rel="canonical" href="{{canonical_url}}">
  {%- if settings.favicon != blank -%}
  <link rel="shortcut icon" href="{{ settings.favicon | img_url: '32x32' }}" type="image/png" />
  {%- endif -%}
  
  <!-- Improved resource hints - same connections, better attributes -->
  <link rel="preconnect" href="https://cdn.shopify.com" crossorigin>
  <link rel="preconnect" href="https://ajax.googleapis.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.shopify.com">
  
  <!-- Critical CSS inline - this ADDS styles, doesn't remove any -->
  <style>
    /* Critical CSS for above-the-fold content */
    body{margin:0;padding:0;font-family:Lato,sans-serif}
    .header{display:block;width:100%}
    .announcement-bar{width:100%;text-align:center}
    /* More critical styles can be added here */
  </style>
  
  <!-- CSS files - all preserved but loaded more efficiently -->
  <link href="{{ 'timber.css' | asset_url }}" rel="stylesheet" media="print" onload="this.media='all'">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,900&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <link href="{{ 'vendor.css' | asset_url }}" rel="stylesheet" media="print" onload="this.media='all'">
  <link href="{{ 'slick.min.css' | asset_url }}" rel="stylesheet" media="print" onload="this.media='all'">
  <link href="{{ 'style.css' | asset_url }}" rel="stylesheet" media="print" onload="this.media='all'">
  
  {%- if settings.dark_enable -%}
  <link href="{{ 'dark.css' | asset_url }}" rel="stylesheet" media="print" onload="this.media='all'">
  {%- endif -%}
  
  {% if theme_rtl %}
  <link href="{{ 'theme-rtl.css' | asset_url }}" rel="stylesheet" media="print" onload="this.media='all'">
  {% endif %}
  
  <!-- Fallback for no-JS browsers -->
  <noscript>
    <link href="{{ 'timber.css' | asset_url }}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,900&display=swap" rel="stylesheet">
    <link href="{{ 'vendor.css' | asset_url }}" rel="stylesheet">
    <link href="{{ 'slick.min.css' | asset_url }}" rel="stylesheet">
    <link href="{{ 'style.css' | asset_url }}" rel="stylesheet">
    {%- if settings.dark_enable -%}
    <link href="{{ 'dark.css' | asset_url }}" rel="stylesheet">
    {%- endif -%}
    {% if theme_rtl %}
    <link href="{{ 'theme-rtl.css' | asset_url }}" rel="stylesheet">
    {% endif %}
  </noscript>
  
  <!-- Critical JS that needs to load early -->
  <script src="{{ 'lazysizes.min.js' | asset_url }}" async></script>
  
  <!-- SEO and Open Graph tags - keep these intact -->
  {%- capture seo_title -%}
  {{ page_title }}
  {%- if current_tags -%}
  {%- assign meta_tags = current_tags | join: ', ' %} &ndash; {{ 'general.meta.tags' | t: tags: meta_tags -}}
  {% endif %}
  {%- if current_page != 1 -%}
  &ndash; {{ 'general.meta.page' | t: page: current_page }}
  {%- endif -%}
  {%- unless page_title contains shop.name -%}
  &ndash; {{ shop.name }}
  {%- endunless -%}
  {%- endcapture -%}
  <title>{{ seo_title }}</title>
  
  <!-- Add page description meta tag here -->
  {%- if page_description -%}
  <meta name="description" content="{{ page_description | escape }}">
  {%- endif -%}
  
  <!-- Consider adding social meta tags if not included elsewhere -->
  {%- if template contains 'product' or template contains 'article' -%}
  {%- render 'social-meta-tags' -%}
  {%- endif -%}
  
  {{ content_for_header }}
</head>
<body id="{{ page_title | handle }}" class="{% if customer %}customer-logged-in {% endif %}template-{{ template.name | handle }}" >
  {%- if settings.enable_preloader -%}
  {%- render 'preloader' -%} 
  {%- endif -%}
  {%- if template == 'index' and settings.newsletter_popup_enable -%}
  {%- render 'newsletter-popup' -%}
  {%- endif -%}
  
  <div class="wrapper{% if settings.box_layout_enable %} wrapper-box{% endif %}" {% if template == 'collection' %}id="form_output"{% endif %}>
    {%- if settings.topbar_notification_enable -%}
    {%- if settings.topbar_notification == 'topbar_in_index' and template == 'index' -%}
    {%- render 'top-notification-bar' -%}
    {%- elsif settings.topbar_notification == 'topbar_in_template' -%}
    {%- render 'top-notification-bar' -%}
    {%- endif -%}
    {%- endif -%}
    
    {% sections 'header-group' %}  
    
    {%- if template != 'index' -%}
    {%- section 'breadcrumb' -%}
    {%- endif -%}
    <main>
      {{ content_for_layout }}
    </main> 

    {% sections 'footer-group' %}
  </div>
  
  {%- if settings.compare_product_enalbe -%}
  {%- render 'compare-popup' -%}
  {%- endif -%}
  <!-- Necessary JS -->
  {%- render 'footer-js' with content_for_layout as content_for_layout -%}
  
  <!-- Scripts loaded with defer to improve performance while keeping functionality -->
  <script src="{{ 'core-js.js' | asset_url }}" defer></script>
  <script src="{{ 'the-final-countdown.js' | asset_url }}" defer></script>
  <script src="{{ 'slick.min.js' | asset_url }}" defer></script>
  <script src="{{ 'recent-view.js' | asset_url }}" defer></script>
  <script src="{{ 'compare-product.js' | asset_url }}" defer></script>
  {%- if settings.wishlist_enable -%}
  <script src="{{ 'wishlist.js' | asset_url }}" defer></script>
  {%- endif -%}
  <script src="{{ 'option_selection.js' | shopify_asset_url }}" defer></script>
  <script src="{{ 'api.jquery.js' | shopify_asset_url }}" defer></script>
  <script src="{{ 'cart.api.js' | asset_url }}" defer></script>
  <script src="{{ 'theme.js' | asset_url }}" defer></script>
  <script src="{{ 'fastclick.min.js' | asset_url }}" defer></script>
  <script src="{{ 'timber.js' | asset_url }}" defer></script>
  {%- if template == 'index' and settings.newsletter_popup_enable -%}
  {%- if settings.one_day_popup_enable -%}
  <script src="{{ 'newsletter-js.js' | asset_url }}" defer></script>
  {%- endif -%}
  {%- endif -%}
</body>
</html>