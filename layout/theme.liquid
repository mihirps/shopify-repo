  {% liquid
  assign theme_rtl = false
  if settings.rtl_enable and settings.langauges_rtl == blank
    assign theme_rtl = true
  endif

  if settings.rtl_enable and settings.langauges_rtl != blank
    assign rtl_languages = settings.langauges_rtl | split: ','
    for language in rtl_languages
      if language == request.locale.iso_code
        assign theme_rtl = true
      endif
    endfor
  endif
%}
<!doctype html>
<!--[if IE 9]> <html class="ie9 no-js supports-no-cookies" lang="{{ shop.locale }}"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js supports-no-cookies" lang="{{ request.locale.iso_code }}" {% if theme_rtl %}dir="rtl"{% endif %}> <!--<![endif]-->
  
<head>
  <!-- Basic and Helper page needs -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="{{ settings.color_primary }}">
  <link rel="canonical" href="{{canonical_url}}">
  {%- if settings.favicon != blank -%}
  <link rel="shortcut icon" href="{{ settings.favicon | img_url: '32x32' }}" type="image/png" />
  {%- endif -%}

  <!-- Preconnect to critical domains -->
  <link rel="preconnect" href="https://cdn.shopify.com" crossorigin>
  <link rel="preconnect" href="https://ajax.googleapis.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.shopify.com">
  
  <!-- Critical CSS -->
  <style>
    /* Inline critical CSS here */
    :root {
      --primary-color: {{ settings.color_primary }};
      --secondary-color: {{ settings.color_secondary }};
      --text-color: {{ settings.color_text }};
      --background-color: {{ settings.color_bg }};
    }
    body {
      font-family: 'Lato', sans-serif;
      color: var(--text-color);
      background: var(--background-color);
      line-height: 1.5;
    }
    .wrapper {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
    }
  </style>
  
  <!-- Defer non-critical CSS -->
  <link rel="preload" as="style" href="{{ 'timber.css' | asset_url }}" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" as="style" href="{{ 'vendor.css' | asset_url }}" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" as="style" href="{{ 'style.css' | asset_url }}" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="{{ 'timber.css' | asset_url }}">
    <link rel="stylesheet" href="{{ 'vendor.css' | asset_url }}">
    <link rel="stylesheet" href="{{ 'style.css' | asset_url }}">
  </noscript>
  
  <!-- Conditional CSS -->
  {%- if settings.dark_enable -%}
  <link rel="preload" as="style" href="{{ 'dark.css' | asset_url }}" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="{{ 'dark.css' | asset_url }}"></noscript>
  {%- endif -%}
  
  {% if theme_rtl %}
  <link rel="preload" as="style" href="{{ 'theme-rtl.css' | asset_url }}" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="{{ 'theme-rtl.css' | asset_url }}"></noscript>
  {%- endif -%}
  
  <!-- Core JS -->
  <script>
    // Load core JS asynchronously
    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.async = true;
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }
    
    // Load critical JS immediately
    const criticalJS = [
      '{{ "core-js.js" | asset_url }}',
      '{{ "lazysizes.min.js" | asset_url }}'
    ];
    
    criticalJS.forEach(src => loadScript(src));
    
    // Load non-critical JS after page load
    window.addEventListener('load', () => {
      const nonCriticalJS = [
        '{{ "theme.js" | asset_url }}',
        '{{ "timber.js" | asset_url }}'
      ];
      
      nonCriticalJS.forEach(src => loadScript(src));
    });
  </script>
  
  <!-- Conditional JS -->
  {%- if template contains 'product' -%}
  <script>
    window.addEventListener('load', () => {
      loadScript('{{ "slick.min.js" | asset_url }}');
      loadScript('{{ "slick.min.css" | asset_url }}');
    });
  </script>
  {%- endif -%}
  
  {%- if settings.wishlist_enable -%}
  <script>
    window.addEventListener('load', () => {
      loadScript('{{ "wishlist.js" | asset_url }}');
    });
  </script>
  {%- endif -%}
  
  <!-- Title and description -->
  {%- capture seo_title -%}
  {{ page_title }}
  {%- if current_tags -%}
  {%- assign meta_tags = current_tags | join: ', ' %} &ndash; {{ 'general.meta.tags' | t: tags: meta_tags -}}
  {% endif %}
  {%- if current_page != 1 -%}
  &ndash; {{ 'general.meta.page' | t: page: current_page }}
  {%- endif -%}
  {%- unless page_title contains shop.name -%}
  &ndash; {{ shop.name }}
  {%- endunless -%}
  {%- endcapture -%}
  <title>{{ seo_title }}</title>
  {%- if page_description -%}
  <meta name="description" content="{{ page_description | escape }}">
  {%- endif -%}
  
  <!-- Helpers -->
  {%- render 'social-meta-tags', product: product, article: article -%}
  
  <!-- CSS -->
  {%- render 'header-css' -%}
  
  <!-- Header hook for plugins -->
  {{ content_for_header }}
  
  {% render 'oldIE-js' %}
</head>
<body id="{{ page_title | handle }}" class="{% if customer %}customer-logged-in {% endif %}template-{{ template.name | handle }}" >
  {%- if settings.enable_preloader -%}
  {%- render 'preloader' -%} 
  {%- endif -%}
  
  {%- if template == 'index' and settings.newsletter_popup_enable -%}
  {%- render 'newsletter-popup' -%}
  {%- endif -%}
  
  <div class="wrapper{% if settings.box_layout_enable %} wrapper-box{% endif %}" {% if template == 'collection' %}id="form_output"{% endif %}>
    {%- if settings.topbar_notification_enable -%}
    {%- if settings.topbar_notification == 'topbar_in_index' and template == 'index' -%}
    {%- render 'top-notification-bar' -%}
    {%- elsif settings.topbar_notification == 'topbar_in_template' -%}
    {%- render 'top-notification-bar' -%}
    {%- endif -%}
    {%- endif -%}
    
    {% sections 'header-group' %}  
    
    {%- if template != 'index' -%}
    {%- section 'breadcrumb' -%}
    {%- endif -%}
    
    <main>
      {{ content_for_layout }}
    </main> 

    {% sections 'footer-group' %}
  </div>
  
  {%- if settings.compare_product_enalbe -%}
  {%- render 'compare-popup' -%}
  {%- endif -%}
  
  <!-- Necessary JS -->
  {%- render 'footer-js' with content_for_layout as content_for_layout -%}
</body>
</html>