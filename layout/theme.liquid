{% liquid
  assign theme_rtl = false
  if settings.rtl_enable and settings.langauges_rtl == blank
    assign theme_rtl = true
  endif

  if settings.rtl_enable and settings.langauges_rtl != blank
    assign rtl_languages = settings.langauges_rtl | split: ','
    for language in rtl_languages
      if language == request.locale.iso_code
        assign theme_rtl = true
      endif
    endfor
  endif
%}
<!doctype html>
<!--[if IE 9]> <html class="ie9 no-js supports-no-cookies" lang="{{ shop.locale }}"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js supports-no-cookies" lang="{{ request.locale.iso_code }}" {% if theme_rtl %}dir="rtl"{% endif %}> <!--<![endif]-->
  
<head>
  <!-- Basic and Helper page needs -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="{{ settings.color_primary }}">
  <link rel="canonical" href="{{canonical_url}}">
  {%- if settings.favicon != blank -%}
  <link rel="shortcut icon" href="{{ settings.favicon | img_url: '32x32' }}" type="image/png" />
  {%- endif -%}

  <!-- Preconnect to critical domains -->
  <link rel="preconnect" href="https://cdn.shopify.com" crossorigin>
  <link rel="preconnect" href="https://ajax.googleapis.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.shopify.com">
  <link rel="dns-prefetch" href="https://ajax.googleapis.com">

  <!-- Preload critical CSS -->
  <link rel="preload" as="style" href="{{ 'timber.css' | asset_url }}" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" as="style" href="{{ 'vendor.css' | asset_url }}" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" as="style" href="{{ 'style.css' | asset_url }}" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="{{ 'timber.css' | asset_url }}">
    <link rel="stylesheet" href="{{ 'vendor.css' | asset_url }}">
    <link rel="stylesheet" href="{{ 'style.css' | asset_url }}">
  </noscript>

  <!-- Defer non-critical CSS -->
  <link rel="preload" as="style" href="{{ 'slick.min.css' | asset_url }}" onload="this.onload=null;this.rel='stylesheet'">
  {%- if settings.dark_enable -%}
  <link rel="preload" as="style" href="{{ 'dark.css' | asset_url }}" onload="this.onload=null;this.rel='stylesheet'">
  {%- endif -%}
  {% if theme_rtl %}
  <link rel="preload" as="style" href="{{ 'theme-rtl.css' | asset_url }}" onload="this.onload=null;this.rel='stylesheet'">
  {%- endif -%}
  <link rel="preload" as="style" href="{{ 'skin-and-color.css' | asset_url }}" onload="this.onload=null;this.rel='stylesheet'">

  <!-- Preload critical JavaScript -->
  <link rel="preload" href="{{ 'core-js.js' | asset_url }}" as="script">
  <link rel="preload" href="{{ 'theme.js' | asset_url }}" as="script">
  <link rel="preload" href="{{ 'timber.js' | asset_url }}" as="script">
  <link rel="preload" href="{{ 'option_selection.js' | shopify_asset_url }}" as="script">
  <link rel="preload" href="{{ 'api.jquery.js' | shopify_asset_url }}" as="script">

  <!-- Title and description -->
  {%- capture seo_title -%}
  {{ page_title }}
  {%- if current_tags -%}
  {%- assign meta_tags = current_tags | join: ', ' %} &ndash; {{ 'general.meta.tags' | t: tags: meta_tags -}}
  {% endif %}
  {%- if current_page != 1 -%}
  &ndash; {{ 'general.meta.page' | t: page: current_page }}
  {%- endif -%}
  {%- unless page_title contains shop.name -%}
  &ndash; {{ shop.name }}
  {%- endunless -%}
  {%- endcapture -%}
  <title>{{ seo_title }}</title>
  {%- if page_description -%}
  <meta name="description" content="{{ page_description | escape }}">
  {%- endif -%}

  <!-- Helpers -->
  {%- render 'social-meta-tags', product: product, article: article -%}
  
  <!-- CSS -->
  {%- render 'header-css' -%}
  {% if theme_rtl %}
  {{ 'theme-rtl.css' | asset_url | stylesheet_tag }}
  {% endif %}
  
  <!-- Header hook for plugins -->
  {{ content_for_header }}
  {% render 'oldIE-js' %}
  
  <!-- JS -->
  {%- render 'header-js' -%}
  {% if template contains 'customers' %}
  {{ 'shopify_common.js' | shopify_asset_url | script_tag }}
  {% endif %}
  {% render 'alireviews_core' %}
</head>
<body id="{{ page_title | handle }}" class="{% if customer %}customer-logged-in {% endif %}template-{{ template.name | handle }}" >
  {%- if settings.enable_preloader -%}
  {%- render 'preloader' -%} 
  {%- endif -%}
  {%- if template == 'index' and settings.newsletter_popup_enable -%}
  {%- render 'newsletter-popup' -%}
  {%- endif -%}
  
  <div class="wrapper{% if settings.box_layout_enable %} wrapper-box{% endif %}" {% if template == 'collection' %}id="form_output"{% endif %}>
    {%- if settings.topbar_notification_enable -%}
    {%- if settings.topbar_notification == 'topbar_in_index' and template == 'index' -%}
    {%- render 'top-notification-bar' -%}
    {%- elsif settings.topbar_notification == 'topbar_in_template' -%}
    {%- render 'top-notification-bar' -%}
    {%- endif -%}
    {%- endif -%}
    
    {% sections 'header-group' %}  
    
    {%- if template != 'index' -%}
    {%- section 'breadcrumb' -%}
    {%- endif -%}
    <main>
      {{ content_for_layout }}
    </main> 

    {% sections 'footer-group' %}
  </div>
  
  {%- if settings.compare_product_enalbe -%}
  {%- render 'compare-popup' -%}
  {%- endif -%}
  
  <!-- Load non-critical JavaScript asynchronously -->
  <script>
    function loadScript(src, callback) {
      var script = document.createElement('script');
      script.src = src;
      script.async = true;
      if (callback) script.onload = callback;
      document.body.appendChild(script);
    }

    // Load core scripts first
    loadScript('{{ "core-js.js" | asset_url }}', function() {
      loadScript('{{ "theme.js" | asset_url }}');
      loadScript('{{ "timber.js" | asset_url }}');
    });

    // Load template-specific scripts
    {% if template == 'index' and settings.newsletter_popup_enable %}
    loadScript('{{ "newsletter-js.js" | asset_url }}');
    {% endif %}

    // Load optional features
    {% if settings.currency_enable or settings.compare_product_enalbe %}
    loadScript('{{ "//cdn.shopify.com/s/javascripts/currencies.js" }}');
    loadScript('{{ "jquery.currencies.min.js" | asset_url }}');
    {% endif %}
  </script>
</body>
</html>